<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medidor Melhorado - Photobooth</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #fff;
        }
        .upload-section {
            border: 2px dashed #666;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 10px;
            cursor: pointer;
        }
        .upload-section:hover {
            border-color: #007bff;
        }
        #templatePreview {
            max-width: 100%;
            max-height: 500px;
            display: none;
            margin: 0 auto;
            border: 2px solid #444;
        }
        .instructions {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            line-height: 1.6;
        }
        .area-marker {
            position: absolute;
            border: 3px solid;
            background: rgba(255, 255, 255, 0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 20px;
            text-shadow: 1px 1px 2px black;
        }
        #imageContainer {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }
        .coordinates-output {
            background: #333;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        .marker-controls {
            text-align: center;
            margin: 20px 0;
        }
        .area-info {
            margin: 10px 0;
            padding: 10px;
            background: #2a2a2a;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Medidor Melhorado - Posi√ß√µes Relativas</h1>
        
        <div class="instructions">
            <h3>üìã COMO USAR (MUITO MAIS F√ÅCIL):</h3>
            <ol>
                <li><strong>Carregue seu template</strong> (3375x6000 pixels)</li>
                <li><strong>Clique exatamente no CENTRO de cada √°rea</strong> onde deve ficar cada foto</li>
                <li><strong>O sistema calcula automaticamente</strong> as posi√ß√µes relativas</li>
                <li><strong>Copie o c√≥digo gerado</strong> e cole no celular.html</li>
            </ol>
            <p>üí° <strong>Dica:</strong> Clique no meio de cada espa√ßo vazio do template</p>
        </div>

        <div class="upload-section" id="uploadSection">
            <p>üìÅ CLIQUE AQUI PARA CARREGAR SEU TEMPLATE</p>
            <p><small>Dimens√µes: 3375 √ó 6000 pixels (Vertical)</small></p>
            <input type="file" id="fileInput" accept="image/*" style="display: none;">
        </div>

        <div id="imageContainer" style="display: none;">
            <img id="templatePreview" alt="Template Preview">
        </div>

        <div class="marker-controls">
            <button onclick="addMarker(1)">üìç Marcar Posi√ß√£o da Foto 1</button>
            <button onclick="addMarker(2)">üìç Marcar Posi√ß√£o da Foto 2</button>
            <button onclick="addMarker(3)">üìç Marcar Posi√ß√£o da Foto 3</button>
            <button onclick="clearMarkers()" style="background: #dc3545;">üóëÔ∏è Limpar Marcadores</button>
        </div>

        <div class="coordinates-output">
            <h3>üìã C√ìDIGO GERADO (Cole no celular.html):</h3>
            <pre id="outputCode">// Aguardando marca√ß√µes...</pre>
        </div>

        <div style="text-align: center;">
            <button onclick="copyCode()" style="background: #28a745;">üìã Copiar C√≥digo</button>
        </div>
    </div>

    <script>
        let markers = [];
        let templateWidth = 3375;
        let templateHeight = 6000;

        document.getElementById('uploadSection').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('templatePreview');
                    img.src = e.target.result;
                    img.style.display = 'block';
                    document.getElementById('imageContainer').style.display = 'block';
                    document.getElementById('uploadSection').style.display = 'none';
                    
                    img.onload = function() {
                        clearMarkers();
                    };
                };
                reader.readAsDataURL(file);
            }
        });

        function addMarker(photoNumber) {
            const img = document.getElementById('templatePreview');
            const container = document.getElementById('imageContainer');
            
            // Remove marcador existente
            const existingMarker = document.querySelector(`[data-photo="${photoNumber}"]`);
            if (existingMarker) {
                existingMarker.remove();
                markers = markers.filter(m => m.number !== photoNumber);
            }
            
            // Cria instru√ß√£o
            alert(`üìç Clique no CENTRO da √°rea onde deve ficar a FOTO ${photoNumber}`);
            
            // Adiciona evento de clique √∫nico
            const clickHandler = (e) => {
                const rect = img.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // Calcula posi√ß√µes relativas (0-1)
                const relX = x / rect.width;
                const relY = y / rect.height;
                
                // Converte para pixels no template original
                const absX = Math.round(relX * templateWidth);
                const absY = Math.round(relY * templateHeight);
                
                // Tamanho padr√£o baseado no template (ajust√°vel)
                const width = Math.round(templateWidth * 0.2); // 20% da largura
                const height = Math.round(templateHeight * 0.1); // 10% da altura
                
                // Cria marcador visual
                createVisualMarker(photoNumber, x, y, container);
                
                // Salva marcador
                markers.push({
                    number: photoNumber,
                    relX: relX,
                    relY: relY,
                    absX: absX,
                    absY: absY,
                    width: width,
                    height: height
                });
                
                // Atualiza c√≥digo
                updateCode();
                
                // Remove evento
                img.removeEventListener('click', clickHandler);
            };
            
            img.addEventListener('click', clickHandler, { once: true });
        }

        function createVisualMarker(photoNumber, x, y, container) {
            const marker = document.createElement('div');
            marker.className = 'area-marker';
            marker.dataset.photo = photoNumber;
            marker.textContent = photoNumber;
            
            // Estilo baseado no n√∫mero da foto
            const colors = ['#ff4444', '#44ff44', '#4444ff'];
            marker.style.borderColor = colors[photoNumber - 1];
            marker.style.background = colors[photoNumber - 1] + '40';
            
            // Posiciona o marcador (20px para cima/esquerda para centralizar)
            marker.style.left = (x - 20) + 'px';
            marker.style.top = (y - 20) + 'px';
            marker.style.width = '40px';
            marker.style.height = '40px';
            marker.style.borderRadius = '50%';
            
            container.appendChild(marker);
        }

        function clearMarkers() {
            markers = [];
            document.querySelectorAll('.area-marker').forEach(marker => marker.remove());
            updateCode();
        }

        function updateCode() {
            const output = document.getElementById('outputCode');
            
            if (markers.length === 0) {
                output.textContent = '// Aguardando marca√ß√µes...\n// Clique nos bot√µes acima e depois clique no template';
                return;
            }
            
            // Ordena marcadores por n√∫mero
            markers.sort((a, b) => a.number - b.number);
            
            let code = '// üìç POSI√á√ïES AUTOM√ÅTICAS - Cole no celular.html\n';
            code += '// Baseado nas suas marca√ß√µes no template\n\n';
            code += 'const photoAreas = [\n';
            
            markers.forEach(marker => {
                code += `  {\n`;
                code += `    number: ${marker.number},\n`;
                code += `    x: ${marker.absX},        // ${(marker.relX * 100).toFixed(1)}% da largura\n`;
                code += `    y: ${marker.absY},        // ${(marker.relY * 100).toFixed(1)}% da altura\n`;
                code += `    width: ${marker.width},   // ${Math.round(marker.width/templateWidth*100)}% da largura\n`;
                code += `    height: ${marker.height}  // ${Math.round(marker.height/templateHeight*100)}% da altura\n`;
                code += `  }${marker.number < 3 ? ',' : ''}\n`;
            });
            
            code += '];';
            
            output.textContent = code;
        }

        function copyCode() {
            const text = document.getElementById('outputCode').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ C√≥digo copiado! Agora cole no arquivo celular.html');
            });
        }

        // Inicializa√ß√£o
        updateCode();
    </script>
</body>
</html>
